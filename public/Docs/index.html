<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>Docs</title>
    <meta name="application-name" content="Docs" />
    <meta name="description" content="The Super Cool Docs App" />
    <meta name="viewport" content="viewport-fit=cover,user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="theme-color" content="#378844" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#378844" media="(prefers-color-scheme: dark)">
    <link id="favicon" rel="icon" href="https://cdn.glitch.global/e73a15d2-2f8a-477d-80bc-a6e8167fe97a/application-512.png?v=1700949025274" />
    
    <!-- manifest -->
    <link rel="manifest" href="manifest.json"/>
    
    <!-- PWA - apple specific -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="An App" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" href="https://cdn.glitch.global/e73a15d2-2f8a-477d-80bc-a6e8167fe97a/application-512.png?v=1700949025274" />
    
    <!-- PWA - microsoft specific -->
    <meta name="msapplication-TileColor" content="#0000FF" />
    <meta name="msapplication-TileImage" content="https://cdn.glitch.global/e73a15d2-2f8a-477d-80bc-a6e8167fe97a/application-512.png?v=1700949025274" />

    <!-- manifest -->
    <link rel="manifest" href="manifest.json" />

    <style>
      body {
        font-family: monospace;
        background-color: black;
        color: #20ff20;
        margin: 0px;
        padding: 0px;
        /*padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);*/
        width: 100vw;
        height: 100vh;

      }
      #ui {
        position: fixed;
        width: 100vw;
        height: 100vh;
        scrollbar-width: none; /* Pour les navigateurs bas√©s sur Firefox */
        -ms-overflow-style: none; /* Pour Internet Explorer et Edge */
      }
      #ui::-webkit-scrollbar{display:none;}
      
      #ui-toolbox {
        position: fixed;
        width: 100%;
        height: 100%;
        overflow: auto; /* Permet le d√©filement si n√©cessaire */
        scrollbar-width: none; /* Pour les navigateurs bas√©s sur Firefox */
        -ms-overflow-style: none; /* Pour Internet Explorer et Edge */
      }
      #ui-toolbox::-webkit-scrollbar{display:none;}
      
      center{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);}
      red{color:red;}
      white{color:white;}
      blue{color:blue;}
      green{color:green;}
      yellow{color:yellow;}
      orange{color:orange;}
      purple{color:purple;}
      
      #console-messages {
        position: fixed;
        width: 100vw;
        height: 100vh;
      }
    </style>
    <script>
      window.debug = false;
      
      
      console.log("‚ú®üöÄ Qwark V10 running");
      if (window.location.protocol == "https:") {
        console.log("üîí10 Running in https");
      } else if (
        window.location.protocol !== "https:" &&
        window.location.hostname !== "localhost" &&
        window.location.protocol !== "file:"
      ) {
        window.location.protocol = "https";
        console.log("üîí10 Enforcing https");
      } else {
        console.log("üõ†Ô∏è10 Running in localhost or file, not enforcing https");
      }
    </script>

    <!-- service worker -->
    <script>
      window.messageLog = ['HELLO','HOW ARE YOU']
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register('/Docs/sw.js', { scope: '/Docs/' })
          .then(function (registration) {
            console.log("+-> (1) üòç Service Worker registered", registration);

            // √âcouter les mises √† jour du service worker
            registration.addEventListener("updatefound", function () {
              let newWorker = registration.installing;
              newWorker.addEventListener("statechange", function () {
                switch (newWorker.state) {
                  case "installed":
                    if (navigator.serviceWorker.controller) {
                      console.log(
                        "+-> (2) ‚ú® Nouvelle version du Service Worker disponible"
                      );
                      // Ici, vous pourriez notifier l'utilisateur ou rafra√Æchir automatiquement la page
                    } else {
                      console.log(
                        "+-> (2) üéâ Service Worker install√© pour la premi√®re fois"
                      );
                    }
                    break;

                  case "redundant":
                    console.error(
                      "!!! (-) üÜò Le nouveau Service Worker a √©t√© rejet√©"
                    );
                    break;
                }
              });
            });
          })
          .catch(function (error) {
            console.error(
              "!!! (-) üÜò Service Worker registration failed",
              error
            );
          });
      } else {
        console.warn("!!! (-) üÜò Service Worker not supported in this browser");
      }
    </script>
  </head>
  
  <body>
    <div id="ui">
      <div id="ui-toolbox"></div>
    </div>
    <div id="console-messages"></div>
    <script type="module" src="app.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
          navigator.serviceWorker.ready.then((registration) => {
            // RECEPTION des messages du Service Worker :
            navigator.serviceWorker.addEventListener("message", (event) => {
              const message = event.data;
              if (message.type === "console-log") {
                if (window.debug) displayConsoleMessage(message.text);
              }
            });
            // Envoie un message "ready" au service worker :
            registration.active.postMessage({ type: "ready" });
          });
        });
      
      // Affichage de message dans le div console
      function displayConsoleMessage(text) {
        const consoleMessagesDiv = document.getElementById("console-messages");
        const messageElement = document.createElement("div");
        // Utilisez innerHTML au lieu de textContent
        messageElement.innerHTML = text.replace(/\n/g, "<br>")
        consoleMessagesDiv.appendChild(messageElement);
      }
      </script>
  </body>
</html>
